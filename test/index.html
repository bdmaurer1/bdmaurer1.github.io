<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Daily Task Manager</title>
  <style>
    :root {
      --bg: #f7f5ef;
      --panel: #fffdf8;
      --text: #1c1c1a;
      --muted: #61615a;
      --line: #ded9cc;
      --brand: #1f6f5f;
      --brand-2: #175648;
      --danger: #a02622;
      --nav-bg: #f3efe3;
      --chip-bg: #e8f0ec;
      --chip-text: #224a3f;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      color: var(--text);
      background:
        radial-gradient(circle at 12% 15%, #ece6d8 0%, transparent 35%),
        radial-gradient(circle at 88% 85%, #e6efe9 0%, transparent 32%),
        var(--bg);
      display: grid;
      place-items: center;
      padding: 20px;
    }

    .app {
      width: min(1060px, 100%);
      background: var(--panel);
      border: 1px solid var(--line);
      border-radius: 14px;
      box-shadow: 0 10px 28px rgba(0, 0, 0, 0.08);
      overflow: hidden;
      display: grid;
      grid-template-columns: 260px 1fr;
    }

    .sidebar {
      background: var(--nav-bg);
      border-right: 1px solid var(--line);
      padding: 20px 16px;
    }

    .sidebar h2 {
      margin: 0 0 16px;
      font-size: 1.05rem;
    }

    .filter-group {
      margin-bottom: 18px;
    }

    .filter-group h3 {
      margin: 0 0 8px;
      color: var(--muted);
      font-size: 0.88rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .filter-btn {
      width: 100%;
      text-align: left;
      background: #fff;
      color: var(--text);
      border: 1px solid var(--line);
      border-radius: 8px;
      padding: 8px 10px;
      margin-top: 6px;
      cursor: pointer;
      transition: background 140ms ease, border-color 140ms ease;
    }

    .filter-btn:hover {
      background: #f8f6f0;
    }

    .filter-btn.active {
      background: var(--brand);
      color: #fff;
      border-color: var(--brand);
    }

    .content {
      min-width: 0;
    }

    .header {
      padding: 20px 24px;
      border-bottom: 1px solid var(--line);
      background: linear-gradient(90deg, #f4efe2, #eef5ef);
    }

    .header h1 {
      margin: 0;
      font-size: 1.5rem;
    }

    .header p {
      margin: 6px 0 0;
      color: var(--muted);
      font-size: 0.95rem;
    }

    .controls {
      padding: 20px 24px;
      border-bottom: 1px solid var(--line);
      display: grid;
      grid-template-columns: 1.2fr 0.8fr 0.8fr auto;
      gap: 10px;
    }

    input,
    select,
    button {
      font: inherit;
    }

    input,
    select {
      padding: 10px 12px;
      border: 1px solid var(--line);
      border-radius: 8px;
      background: #fff;
    }

    button {
      padding: 10px 14px;
      border: 0;
      border-radius: 8px;
      background: var(--brand);
      color: #fff;
      cursor: pointer;
      transition: background 140ms ease;
    }

    button:hover {
      background: var(--brand-2);
    }

    .tasks {
      padding: 16px 24px 24px;
    }

    .summary {
      color: var(--muted);
      font-size: 0.92rem;
      margin: 0 0 8px;
    }

    .task-card {
      border: 1px solid var(--line);
      border-radius: 10px;
      padding: 14px;
      margin-top: 12px;
      background: #fff;
    }

    .task-top {
      display: flex;
      justify-content: space-between;
      gap: 10px;
      align-items: flex-start;
    }

    .task-title {
      margin: 0;
      font-weight: 600;
    }

    .task-title.done {
      text-decoration: line-through;
      color: var(--muted);
    }

    .meta {
      color: var(--muted);
      font-size: 0.9rem;
      margin-top: 4px;
    }

    .badge {
      display: inline-block;
      margin-top: 8px;
      border-radius: 999px;
      padding: 3px 10px;
      background: var(--chip-bg);
      color: var(--chip-text);
      font-size: 0.78rem;
      font-weight: 600;
    }

    .badge.high {
      background: #f6e3e0;
      color: #8b1f18;
    }

    .badge.medium {
      background: #f6f0dc;
      color: #7a5a07;
    }

    .badge.low {
      background: #dff1e9;
      color: #1f6f5f;
    }

    .actions {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .delete-btn {
      background: #f7e5e5;
      color: var(--danger);
      border: 1px solid #efcbcb;
      padding: 6px 10px;
      border-radius: 8px;
    }

    .delete-btn:hover {
      background: #f2d5d5;
    }

    .subtask-list {
      list-style: none;
      margin: 10px 0 0;
      padding: 0;
      display: grid;
      gap: 7px;
    }

    .subtask-item {
      display: flex;
      align-items: center;
      gap: 8px;
      color: #2c2c29;
    }

    .subtask-item.done span {
      text-decoration: line-through;
      color: var(--muted);
    }

    .subtask-form {
      margin-top: 10px;
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 8px;
    }

    .empty {
      color: var(--muted);
      text-align: center;
      padding: 20px 0;
    }

    @media (max-width: 900px) {
      .app {
        grid-template-columns: 1fr;
      }

      .sidebar {
        border-right: 0;
        border-bottom: 1px solid var(--line);
      }

      .controls {
        grid-template-columns: 1fr;
      }

      .actions {
        flex-wrap: wrap;
      }
    }
  </style>
</head>
<body>
  <main class="app">
    <aside class="sidebar">
      <h2>View Tasks</h2>

      <div class="filter-group">
        <h3>Priority</h3>
        <button class="filter-btn active" data-filter-type="priority" data-filter-value="All" type="button">All Priorities</button>
        <button class="filter-btn" data-filter-type="priority" data-filter-value="High" type="button">High</button>
        <button class="filter-btn" data-filter-type="priority" data-filter-value="Medium" type="button">Medium</button>
        <button class="filter-btn" data-filter-type="priority" data-filter-value="Low" type="button">Low</button>
      </div>

      <div class="filter-group">
        <h3>Category</h3>
        <button class="filter-btn active" data-filter-type="category" data-filter-value="All" type="button">All Categories</button>
        <button class="filter-btn" data-filter-type="category" data-filter-value="Personal" type="button">Personal</button>
        <button class="filter-btn" data-filter-type="category" data-filter-value="Work" type="button">Work</button>
        <button class="filter-btn" data-filter-type="category" data-filter-value="Health" type="button">Health</button>
        <button class="filter-btn" data-filter-type="category" data-filter-value="Study" type="button">Study</button>
        <button class="filter-btn" data-filter-type="category" data-filter-value="Errands" type="button">Errands</button>
      </div>
    </aside>

    <section class="content">
      <section class="header">
        <h1>Daily Task Manager</h1>
        <p>Add tasks, organize by category, and break work into subtasks.</p>
      </section>

      <section class="controls">
        <input id="taskInput" type="text" placeholder="Task title" />
        <select id="categoryInput">
          <option value="Work">Work</option>
          <option value="Personal">Personal</option>
          <option value="Health">Health</option>
          <option value="Study">Study</option>
          <option value="Errands">Errands</option>
        </select>
        <select id="priorityInput">
          <option value="High">High Priority</option>
          <option value="Medium" selected>Medium Priority</option>
          <option value="Low">Low Priority</option>
        </select>
        <button id="addTaskBtn" type="button">Add Task</button>
      </section>

      <section class="tasks" id="taskList"></section>
    </section>
  </main>

  <script>
    const STORAGE_KEY = "daily-task-manager-v2";
    const LEGACY_STORAGE_KEY = "daily-task-manager-v1";

    const taskInput = document.getElementById("taskInput");
    const categoryInput = document.getElementById("categoryInput");
    const priorityInput = document.getElementById("priorityInput");
    const addTaskBtn = document.getElementById("addTaskBtn");
    const taskList = document.getElementById("taskList");
    const sidebar = document.querySelector(".sidebar");

    let tasks = loadTasks();
    let activePriorityFilter = "All";
    let activeCategoryFilter = "All";

    function loadTasks() {
      try {
        const saved = localStorage.getItem(STORAGE_KEY);
        const fallback = localStorage.getItem(LEGACY_STORAGE_KEY);
        const parsed = saved ? JSON.parse(saved) : (fallback ? JSON.parse(fallback) : []);

        return parsed.map(task => ({
          ...task,
          priority: task.priority || "Medium",
          subtasks: Array.isArray(task.subtasks) ? task.subtasks : []
        }));
      } catch {
        return [];
      }
    }

    function saveTasks() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(tasks));
    }

    function makeId() {
      return Math.random().toString(36).slice(2, 10);
    }

    function addTask() {
      const title = taskInput.value.trim();
      const category = categoryInput.value;
      const priority = priorityInput.value;
      if (!title) return;

      tasks.unshift({
        id: makeId(),
        title,
        category,
        priority,
        done: false,
        subtasks: []
      });

      taskInput.value = "";
      saveTasks();
      renderTasks();
    }

    function toggleTask(taskId) {
      const task = tasks.find(t => t.id === taskId);
      if (!task) return;
      task.done = !task.done;
      saveTasks();
      renderTasks();
    }

    function deleteTask(taskId) {
      tasks = tasks.filter(t => t.id !== taskId);
      saveTasks();
      renderTasks();
    }

    function addSubtask(taskId, text) {
      const task = tasks.find(t => t.id === taskId);
      if (!task) return;

      const value = text.trim();
      if (!value) return;

      task.subtasks.push({
        id: makeId(),
        text: value,
        done: false
      });

      saveTasks();
      renderTasks();
    }

    function toggleSubtask(taskId, subtaskId) {
      const task = tasks.find(t => t.id === taskId);
      if (!task) return;
      const subtask = task.subtasks.find(s => s.id === subtaskId);
      if (!subtask) return;

      subtask.done = !subtask.done;
      saveTasks();
      renderTasks();
    }

    function getFilteredTasks() {
      return tasks.filter(task => {
        const matchesPriority =
          activePriorityFilter === "All" || task.priority === activePriorityFilter;
        const matchesCategory =
          activeCategoryFilter === "All" || task.category === activeCategoryFilter;
        return matchesPriority && matchesCategory;
      });
    }

    function renderTasks() {
      const filteredTasks = getFilteredTasks();
      const summary = `<p class="summary">Showing ${filteredTasks.length} of ${tasks.length} tasks | Priority: ${escapeHtml(activePriorityFilter)} | Category: ${escapeHtml(activeCategoryFilter)}</p>`;

      if (!filteredTasks.length) {
        taskList.innerHTML = `${summary}<p class='empty'>No tasks match the current filters.</p>`;
        return;
      }

      taskList.innerHTML = summary;

      filteredTasks.forEach(task => {
        const card = document.createElement("article");
        card.className = "task-card";

        const subtaskRows = task.subtasks
          .map(subtask => {
            const checked = subtask.done ? "checked" : "";
            const doneClass = subtask.done ? "done" : "";
            return `
              <li class="subtask-item ${doneClass}">
                <input type="checkbox" data-role="toggle-subtask" data-task-id="${task.id}" data-subtask-id="${subtask.id}" ${checked} />
                <span>${escapeHtml(subtask.text)}</span>
              </li>
            `;
          })
          .join("");

        const priorityClass = task.priority.toLowerCase();

        card.innerHTML = `
          <div class="task-top">
            <div>
              <p class="task-title ${task.done ? "done" : ""}">${escapeHtml(task.title)}</p>
              <p class="meta">Category: ${escapeHtml(task.category)}</p>
              <span class="badge ${priorityClass}">${escapeHtml(task.priority)} Priority</span>
            </div>
            <div class="actions">
              <label>
                <input type="checkbox" data-role="toggle-task" data-task-id="${task.id}" ${task.done ? "checked" : ""} /> Done
              </label>
              <button class="delete-btn" data-role="delete-task" data-task-id="${task.id}" type="button">Delete</button>
            </div>
          </div>

          <ul class="subtask-list">${subtaskRows}</ul>

          <form class="subtask-form" data-role="subtask-form" data-task-id="${task.id}">
            <input type="text" name="subtask" placeholder="Add subtask" />
            <button type="submit">Add Subtask</button>
          </form>
        `;

        taskList.appendChild(card);
      });
    }

    // Prevent basic HTML injection from user-entered text.
    function escapeHtml(text) {
      return String(text)
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/\"/g, "&quot;")
        .replace(/'/g, "&#039;");
    }

    function setActiveFilter(type, value) {
      if (type === "priority") {
        activePriorityFilter = value;
      }

      if (type === "category") {
        activeCategoryFilter = value;
      }

      document.querySelectorAll(`.filter-btn[data-filter-type="${type}"]`).forEach(button => {
        button.classList.toggle("active", button.dataset.filterValue === value);
      });

      renderTasks();
    }

    addTaskBtn.addEventListener("click", addTask);

    taskInput.addEventListener("keydown", event => {
      if (event.key === "Enter") addTask();
    });

    sidebar.addEventListener("click", event => {
      const target = event.target;
      if (!(target instanceof HTMLButtonElement)) return;
      if (target.dataset.filterType !== "priority" && target.dataset.filterType !== "category") return;

      setActiveFilter(target.dataset.filterType, target.dataset.filterValue);
    });

    taskList.addEventListener("click", event => {
      const target = event.target;
      if (!(target instanceof HTMLElement)) return;

      if (target.dataset.role === "delete-task") {
        deleteTask(target.dataset.taskId);
      }
    });

    taskList.addEventListener("change", event => {
      const target = event.target;
      if (!(target instanceof HTMLInputElement)) return;

      if (target.dataset.role === "toggle-task") {
        toggleTask(target.dataset.taskId);
      }

      if (target.dataset.role === "toggle-subtask") {
        toggleSubtask(target.dataset.taskId, target.dataset.subtaskId);
      }
    });

    taskList.addEventListener("submit", event => {
      event.preventDefault();
      const form = event.target;
      if (!(form instanceof HTMLFormElement)) return;
      if (form.dataset.role !== "subtask-form") return;

      const input = form.querySelector("input[name='subtask']");
      if (!(input instanceof HTMLInputElement)) return;

      addSubtask(form.dataset.taskId, input.value);
      input.value = "";
    });

    renderTasks();
  </script>
</body>
</html>

